{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Self%20Project/Smart%20EV%20Charging%20Optimization%20Platform/frontend/src/app/page.tsx"],"sourcesContent":["\"use client\";\nimport React, { useState } from \"react\";\nimport { LineChart, Line, XAxis, YAxis, Tooltip, CartesianGrid, ResponsiveContainer } from \"recharts\";\n\nexport default function Home() {\n  const [battery, setBattery] = useState(20);\n  const [power, setPower] = useState(7);\n  const [departure, setDeparture] = useState(\"14:10\");\n  const [cheapMode, setCheapMode] = useState(false);\n\n  const [result, setResult] = useState(null);\n  const [countdown, setCountdown] = useState(\"\");\n\n  // -----------------------------\n  // Countdown – 依据后端 end_time => HH:MM\n  // -----------------------------\n  const calculateCountdown = (endTimeStr) => {\n    const now = new Date();\n    const [h, m] = endTimeStr.split(\":\").map(Number);\n\n    const end = new Date();\n    end.setHours(h, m, 0, 0);\n\n    if (end <= now) {\n      end.setDate(end.getDate() + 1);\n    }\n\n    const diff = end - now;\n    const hrs = Math.floor(diff / 3600000);\n    const mins = Math.floor((diff % 3600000) / 60000);\n\n    return `${hrs}h ${mins}m`;\n  };\n\n  // -----------------------------\n  // Handle Optimize\n  // -----------------------------\n  const handleOptimize = async () => {\n    setResult(null);\n\n    try {\n      const res = await fetch(\"http://localhost:8000/predict\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          battery_level: battery,\n          charger_power: power,\n          target_time: departure,\n          cheap_mode: cheapMode,\n          target_soc: 80,\n        }),\n      });\n\n      const data = await res.json();\n      if (!res.ok) throw new Error(data.error || \"Request failed\");\n\n      // 保存 backend 返回的结果\n      setResult(data);\n\n      // 使用后端给的 end_time 来算 countdown（正确）\n      setCountdown(calculateCountdown(data.end_time));\n\n    } catch (err) {\n      alert(\"⚠️ Backend error\");\n    }\n  };\n\n  // -----------------------------\n  // Charging Needed 由后端 hours 直接显示\n  // -----------------------------\n  const renderChargingInfo = () => {\n    if (!result) return null;\n\n    return (\n      <div className=\"p-4 border rounded bg-gray-100\">\n        <p><b>Charging Needed:</b> {result.hours.toFixed(2)} h</p>\n        <p><b>Start Time:</b> {result.start_time}</p>\n        <p><b>End Time:</b> {result.end_time}</p>\n        <p><b>Countdown:</b> {countdown}</p>\n      </div>\n    );\n  };\n\n  // -----------------------------\n  // Timeline 图表（直接用后端 timeline）\n  // -----------------------------\n  const renderChart = () => {\n    if (!result?.timeline) return null;\n\n    // 格式符合 Recharts 需要\n    const chartData = result.timeline.map((p) => ({\n      time: p.time,\n      soc: p.soc,\n    }));\n\n    return (\n      <ResponsiveContainer width=\"100%\" height={300}>\n        <LineChart data={chartData}>\n          <CartesianGrid strokeDasharray=\"3 3\" />\n\n          <XAxis dataKey=\"time\" />\n          <YAxis domain={[0, 100]} />\n          <Tooltip />\n\n          <Line type=\"monotone\" dataKey=\"soc\" stroke=\"#8884d8\" strokeWidth={2} dot={false} />\n        </LineChart>\n      </ResponsiveContainer>\n    );\n  };\n\n  // -----------------------------\n  // UI\n  // -----------------------------\n  return (\n    <div className=\"p-6 max-w-2xl mx-auto space-y-6\">\n\n      <h1 className=\"text-xl font-bold\">EV Charging Optimizer</h1>\n\n      {/* Inputs */}\n      <div className=\"space-y-4\">\n\n        <div>\n          <label>Battery Level (%)</label>\n          <input type=\"number\" value={battery}\n            className=\"block w-full border p-2\"\n            onChange={(e) => setBattery(Number(e.target.value))} />\n        </div>\n\n        <div>\n          <label>Charger Power (kW)</label>\n          <input type=\"number\" value={power}\n            className=\"block w-full border p-2\"\n            onChange={(e) => setPower(Number(e.target.value))} />\n        </div>\n\n        <div>\n          <label>Departure Time</label>\n          <input type=\"time\" value={departure}\n            className=\"block w-full border p-2\"\n            onChange={(e) => setDeparture(e.target.value)} />\n        </div>\n\n        <div>\n          <label className=\"flex gap-2 items-center\">\n            <input type=\"checkbox\"\n              checked={cheapMode}\n              onChange={(e) => setCheapMode(e.target.checked)} />\n            Optimize by Electricity Cost\n          </label>\n        </div>\n\n        <button\n          onClick={handleOptimize}\n          className=\"bg-blue-600 text-white px-4 py-2 rounded\"\n        >\n          Calculate\n        </button>\n\n      </div>\n\n      {/* Output */}\n      {renderChargingInfo()}\n      {renderChart()}\n\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}